<!-- <p>home works!</p> -->
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/data.js"></script>
<script src="https://code.highcharts.com/stock/modules/drag-panes.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<script src="https://code.highcharts.com/stock/indicators/indicators.js"></script>
<script src="https://code.highcharts.com/stock/indicators/volume-by-price.js"></script>


<app-header [pageName] = "'search/ticker'"></app-header>
<h2 style="text-align: center; margin-top: 50px; font-size: 4vh;">Stock Search</h2>
<app-inputform [tickerSymbol]="ticker" (resetClicked)="resetContent()"></app-inputform>
<div *ngIf="displayStatus">
    <!-- <app-nostockdata [alertInfo]=alertInfo></app-nostockdata> -->
    <div *ngFor="let alert of alerts">
        <app-nostockdata [alertInfo]="alert.alertInfo" [isTimer]="alert.isTimer"></app-nostockdata>
    </div>
    <div *ngIf="!(isSummaryDataLoaded && isHighTabDataLoaded && isInsightsChart1DataLoaded && isInsightsChart2DataLoaded && isCompanyDescriptionDataLoaded &&
isInsiderSentimentDataLoaded && isCompanyPeersDataLoaded && 
isCompanyNewsDataLoaded && isWatchlistDataLoaded &&
isGetLatestPriceDataLoaded)" class="center-spinner"><mat-spinner [diameter]="50"></mat-spinner></div>
    <div *ngIf="isSummaryDataLoaded &&
             isHighTabDataLoaded && isCompanyPeersDataLoaded &&
             isInsightsChart1DataLoaded &&
             isInsightsChart2DataLoaded &&
             isInsiderSentimentDataLoaded && isCompanyDescriptionDataLoaded &&
             isCompanyNewsDataLoaded && isWatchlistDataLoaded &&
             isGetLatestPriceDataLoaded" class="container text-center mt-5">
        <div class="row">
            <div class="col">
                <div style="display: flex; align-items: center; justify-content: center;">
                    <h1 style="display: flex; align-items: center;" class="mb-0 me-2">{{tickerSymbol}}</h1> <i
                        class="bi bi-star" style="cursor: pointer;" *ngIf="!clicked" (click)="addedToWishlist()"></i><i
                        *ngIf="clicked" style="color: rgb(221, 221, 0); cursor: pointer;" (click)="deleteFromWishlist()"
                        class="bi bi-star-fill"></i>
                </div>
                <div style="color:#5a5c5e">
                    <h2 class="mb-0">{{companyName}}</h2>
                </div>
                <div style="color:#515151">{{exchange}}</div>
                <div class="button-container">
                    <button type="button" *ngIf="btnStatusBuy" (click)="openBuyModal(buyContent)"
                        class="btn btn-success">Buy</button>
                    <button type="button" *ngIf="btnStatusSell" (click)="openSellModal(sellContent)"
                        class="btn btn-danger">Sell</button>
                </div>

                <!-- This is the Buy Modal-->
                <ng-template #buyContent let-modal>
                    <div class="modal-header">
                        <h4 class="modal-title">{{modalTickerSymbol || tickerSymbol}}</h4>
                        <button type="button" class="btn-close" aria-label="Close"
                            (click)="modal.dismiss('Cross click')"></button>
                    </div>
                    <div class="modal-body">
                        <p>Current Price: {{modalCurrentPrice}}<br>
                            Money in Wallet: ${{roundof(finalMoneyInWallet)}}<br>
                            Quatity: <input style="display:inline; width:80%" type="number" class="form-control"
                                id="floatingInput" [(ngModel)]="currentQuantity" (ngModelChange)="calculateTotal()"
                                min="0">
                        </p>
                        <span *ngIf="total > finalMoneyInWallet" style="color:red" class="mt-0">Not enough money in
                            wallet</span>
                    </div>
                    <div class="modal-footer buy_sell_modal" style="justify-content: space-between;">
                        <p class="totals mb-0">Total: {{roundof(total)}}</p>
                        <button type="button" class="btn btn-success"
                            (click)="boughtsuccessfully(modalTickerSymbol, modalCompanyName, currentQuantity, modalCurrentPrice, 'buy')"
                            [disabled]="(total > finalMoneyInWallet) || (currentQuantity <= 0)">Buy</button>
                        <!-- <button style="float:right" type="button" *ngIf="currentAction === 'sell'" class="btn btn-success"
                        (click)="soldsuccessfully()">Sell</button> -->

                        <!-- <button type="button" class="btn btn-secondary" (click)="modal.close('Close click')">Close</button> -->
                    </div>
                </ng-template>

                <!-- This is the Sell Modal-->
                <ng-template #sellContent let-modal>
                    <div class="modal-header">
                        <h4 class="modal-title">{{modalTickerSymbol}}</h4>
                        <button type="button" class="btn-close" aria-label="Close"
                            (click)="modal.dismiss('Cross click')"></button>
                    </div>
                    <div class="modal-body">
                        <p>Current Price: {{roundof(modalCurrentPrice)}}<br>
                            Money in Wallet: ${{roundof(finalMoneyInWallet)}}<br>
                            Quatity: <input style="display:inline; width:80%" type="number" class="form-control"
                                id="floatingInput" [(ngModel)]="currentQuantity" (ngModelChange)="calculateTotal()"
                                min="0">
                        </p>
                        <span *ngIf="currentQuantity > modalQuantity" style="color:red" class="mt-0">You cannot sell
                            stocks
                            that you do not have</span>
                    </div>
                    <div class="modal-footer buy_sell_modal" style="justify-content: space-between;">
                        <p class="totals mb-0">Total: {{roundof(total)}}</p>
                        <!-- <button type="button" *ngIf="currentAction === 'buy'" class="btn btn-success"
                        (click)="boughtsuccessfully()" [disabled]="(quantity * currentPrice > wallet) || (quantity == 0)">Buy</button> -->
                        <button style="float:right" type="button" class="btn btn-success"
                            [disabled]="(currentQuantity <= 0) || (currentQuantity > modalQuantity)"
                            (click)="soldsuccessfully(modalTickerSymbol, modalCompanyName, currentQuantity, modalCurrentPrice, 'sell')">Sell</button>

                        <!-- Disable sell button is the quantity of the stock bought is 0-->
                    </div>
                </ng-template>

            </div>
            <div class="col">
                <img [src]="logo" class="companyLogo" alt="CompanyLogo" style="width: 90px; height: 90px;">
            </div>
            <div class="col" [style.color]=stockPrice>
                <div>
                    <h1 class="mb-0">{{lastPrice}}</h1>
                </div>
                <div>
                    <h3 class="mb-0">
                        <i *ngIf="stockPrice === 'green'" class="bi bi-caret-up-fill"></i>
                        <i *ngIf="stockPrice === 'red'" class="bi bi-caret-down-fill"></i>
                        {{change}} ({{changePercent}}%)
                    </h3>
                </div>
                <div style="color:black">{{currentTimeStamp}}</div>
            </div>
        </div>
        <div class="mt-2" [ngStyle]="{ 'color': marketStatus ? 'green' : 'red' }">
            Market <span>{{ marketStatus ? 'is Open' : 'Closed on ' + closingMarketDate }}</span>
        </div>
        <!-- <div class="container" style="width:100%"> -->
        <mat-tab-group class="container mb-4">
            <mat-tab label="Summary">
                <div class="container text-center">
                    <div class="row">
                        <div class="col">
                            <div class="container text-center">
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <p class="mb-0"> <b>High Price:</b> {{highPrice}}</p>
                                        <p class="mb-0"> <b>Low Price:</b> {{lowPrice}}</p>
                                        <p class="mb-0"> <b>Open Price:</b> {{openPrice}}</p>
                                        <p> <b>Prev. Close:</b> {{prevClose}}</p>
                                    </div>
                                    <!-- <div class="col">
                                Column
                              </div> -->
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <h3 class="mt-2"><b><u>About the Company</u></b></h3>
                                        <p class="mt-4 mb-0"><b>IPO Start Date:</b> {{ipo}}</p>
                                        <p class="mt-2 mb-0"><b>Industry:</b> {{finnhubIndustry}}</p>
                                        <p class="mt-2 mb-0"><b>Webpage:</b> <a href="{{weburl}}" target="_blank">{{weburl}}</a></p>
                                        <p class="mt-2 mb-0"><b>Company peers:</b></p>
                                        <p class="mt-2">
                                            <ng-container *ngFor="let companyName of companyPeers; let last = last">
                                                <a [routerLink]="['/search', companyName]">{{ companyName }}</a>{{
                                                !last
                                                ?
                                                ', ' : '' }}
                                            </ng-container>
                                        </p>
                                        <!-- <p class="mt-2"><a href="">AAPL</a>, <a href="">DELL</a>, <a href="">SMCI</a>, <a
                                            href="">HPO</a>, <a href="">HPE</a>, <a href="">WDC</a>, <a
                                            href="">NTAP</a>, <a href="">PSTG</a>, <a href="">XRX</a></p> -->
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="col">
                            <div class="summaryChart">
                                <highcharts-chart [Highcharts]="Highcharts" [options]="chartOptions"
                                    style="width: 100%; height: 400px; display: block;">
                                </highcharts-chart>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <mat-tab label="Top News">
                <!-- <div class="row">
                <div class="row text-center io">
                    <div class="col bdy">
                        <div class="card-body">
                            <p class="card-text">Card Body.</p>
                        </div>
                    </div>
                    <div class="col bdy">
                        <div class="card-body">
                            <p class="card-text">Card Body.</p>
                        </div>
                    </div>
                </div>
            </div> -->

                <div *ngFor="let row of matrix; let rowIndex = index" class="row"
                    style="margin: 0px; margin-top: 10px;">
                    <div *ngFor="let item of row; let colIndex = index" class="col-sm-6">
                        <div class="card mb-3" style="max-width: 100%; background-color:#f9f9f9; cursor: pointer;"
                            (click)="openNewsWindowCustomClass(Newscontent, item)">
                            <div class="row no-gutters px-2 py-2">
                                <!-- <div class="col-md-4 card-body">
                                        <img src="{{item.imageUrl}}" alt="ImageHere"
                                            class="newsImage mx-auto d-block rounded" style=" height: 100%;"
                                            width="100%">
                                    </div>
                                    <div class="col-md-8 text-center d-flex"
                                        style="align-items: center !important; top: auto; bottom: auto; margin: auto 0px;">
                                        <div class="card-body">
                                            <span class="card-text">{{item.title}}</span>
                                        </div>
                                    </div> -->
                                <div class="col-12 col-md-4 d-none d-md-block">
                                    <img class="card-img-left" src="{{ item.imageUrl }}" style="
                                                                width: 100%;
                                                                height: 100px;
                                                                border-radius: 3%;
                                                                object-fit: fill;
                                                              " alt="Card image cap" />
                                </div>
                                <div class="col-12 col-md-4 d-md-none">
                                    <img class="card-img-left" src="{{ item.imageUrl }}" style="
                                                                width: 100%;
                                                                height: 200px;
                                                                border-radius: 3%;
                                                                object-fit: fill;
                                                              " alt="Card image cap" />
                                </div>
                                <div
                                    class="col-12 col-md-8 d-flex align-items-center justify-content-center text-center px-2">
                                    <h5 class="card-title">{{ item.title }}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div *ngFor="let row of matrix; let rowIndex = index" class="row">
                    
                        <div *ngFor="let item of row; let colIndex = index" class="col-lg-6">
                            <div class="card mb-3" style="padding:10px;" (click)="openNewsWindowCustomClass(Newscontent, item)"
                                style="cursor: pointer;">
                                <div class="row no-gutters">
                                    <div class="col-12 col-md-4">
                                        <img src="{{item.imageUrl}}" alt="Image"
                                            class="img-fluid mx-auto d-block rounded">
                                    </div>
                                    <div class="col-12 col-md-8 d-flex align-items-center">
                                        <div class="card-body text-center">
                                            <span class="card-text">{{item.title}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                    </div>
                </div> -->

                <!-- <div *ngFor="let row of matrix; let rowIndex = index" class="row">
                    <div *ngFor="let item of row; let colIndex = index" class="col-lg-6 col-md-6 col-sm-12 mb-4">
                        <div class="card h-100">
                            <img src="{{item.imageUrl}}" alt="Image" class="card-img-top img-fluid" style="height: 200px; object-fit: cover;">
                            <div class="card-body text-center">
                                <span class="card-text">{{item.title}}</span>
                            </div>
                        </div>
                    </div>
                </div> -->

                <!-- <div *ngFor="let row of matrix; let rowIndex = index" class="row">
                    <div *ngFor="let item of row; let colIndex = index" class="col-12 col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="row no-gutters">
                                <div class="col-4 col-md-12">
                                    <img src="{{item.imageUrl}}" alt="Image" class="img-fluid w-100" style="height: 200px; object-fit: cover;">
                                </div>
                                <div class="col-8 col-md-12">
                                    <div class="card-body text-center">
                                        <span class="card-text">{{item.title}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->

                <!-- <div *ngFor="let row of matrix; let rowIndex = index" class="row">
                    <div *ngFor="let item of row; let colIndex = index" class="col-12 col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="row g-0">
                                <div class="col-4 col-md-12 col-lg-4">
                                    
                                    <div class="d-flex">
                                        <img src="{{item.imageUrl}}" alt="Image" class="w-100" style="object-fit: cover; height: 200px;">
                                    </div>
                                </div>
                                <div class="col-8 col-md-12 col-lg-8">
                                    <div class="card-body">
                                        <p class="card-text">{{item.title}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div> -->

                <ng-template #Newscontent let-modal>
                    <div class="modal-header" style="display: block;">
                        <div class="row">
                            <div class="col">
                                <h2 class="modal-title mb-0">{{selectedNewsItem.source}}</h2>
                                <h3 style="display:block;" class="mt-0">{{selectedNewsItem.date}}</h3>
                            </div>
                            <div class="col" style="display: flex; align-items: center;">
                                <!-- <svg style="float:right" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                              </svg> -->
                                <button type="button" class="btn-close" style="float:right" aria-label="Close"
                                    (click)="modal.dismiss('Cross click')"></button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body">
                        <h2 class="mb-0"><b>{{selectedNewsItem.title}}</b></h2>
                        <p class="mt-0 mb-0">{{selectedNewsItem.summary}}</p>
                        <p class="mt-0" style="color:#abacad">For more details click <a
                                target="_blank" href="{{selectedNewsItem.url}}">here</a></p>
                    </div>
                    <div class="modal-footer"
                        style="border: 1px solid #9d9d9d; justify-content: start; display: block; margin: 12px;">
                        <div class="mb-0">
                            <p style="color: #9d9d9d">Share</p>
                        </div>
                        <!-- <button type="button" class="btn btn-secondary" (click)="modal.close('Close click')">Close</button> -->
                        <!-- <a style="display: block;" class="twitter-share-button" href="https://twitter.com/intent/tweet?text={{selectedNewsItem.title}}&url={{selectedNewsItem.url}}">Tweet</a> -->

                        <div class="mb-0">
                            <a target="_blank" class="twitter-share-button"
                                [href]="getTwitterShareUrl(selectedNewsItem)"><svg xmlns="http://www.w3.org/2000/svg"
                                    width="30" height="30" fill="black" class="bi bi-twitter-x" viewBox="0 0 16 16">
                                    <path
                                        d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                                </svg></a>
                            <a target="_blank"
                                href="https://www.facebook.com/sharer/sharer.php?u={{selectedNewsItem.imageUrl}}"
                                class="fb-xfbml-parse-ignore"><svg xmlns="http://www.w3.org/2000/svg" width="30"
                                    height="30" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
                                    <path
                                        d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951" />
                                </svg></a>
                        </div>
                    </div>
                </ng-template>

            </mat-tab>
            <mat-tab label="charts">
                <highcharts-chart [Highcharts]="HighTabcharts" [options]="chartTabOptions"
                    [constructorType]="'stockChart'" style="width: 100%; height: 400px; display: block;">
                </highcharts-chart>
            </mat-tab>
            <mat-tab label="Insights">
                <!-- <div class="container"> -->
                <h2 class="text-center">Insider Sentiments</h2>

                <div class="row justify-content-center">
                    <div class="col-lg-6 col-sm-12">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">{{companyName}}</th>
                                    <th scope="col">MSPR</th>
                                    <th scope="col">Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">Total</th>
                                    <td>{{totalMSPR}}</td>
                                    <td>{{totalChange}}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Positive</th>
                                    <td>{{totalMSPRPositive}}</td>
                                    <td>{{totalChangePositive}}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Negative</th>
                                    <td>{{totalMSPRNegative}}</td>
                                    <td>{{totalChangeNegative}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12 col-md-6">
                        <highcharts-chart [Highcharts]="InsightsHighcharts1" [options]="InsightschartOptions1"
                            style="width: 100%; display: block;">
                        </highcharts-chart>
                    </div>
                    <div class="col-12 col-md-6">
                        <highcharts-chart [Highcharts]="InsightsHighcharts2" [options]="InsightschartOptions2"
                            style="width: 100%; display: block;">
                        </highcharts-chart>
                    </div>
                </div>
                <!-- </div> -->
            </mat-tab>
        </mat-tab-group>
    </div>
</div>
<!-- </div> -->

<!-- <app-footer></app-footer> -->